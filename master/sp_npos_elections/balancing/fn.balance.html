<!DOCTYPE html><html lang="en"><head><link rel="canonical" href="https://paritytech.github.io/polkadot-sdk/master/sp_npos_elections/balancing/fn.balance.html"><meta http-equiv="refresh" content="0;URL='https://paritytech.github.io/polkadot-sdk/master/sp_npos_elections/balancing/fn.balance.html'"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Balance the weight distribution of a given `voters` at most `iterations` times, or up until the point where the biggest difference created per iteration of all stakes is `tolerance`. If this is called with `tolerance = 0`, then exactly `iterations` rounds will be executed, except if no change has been made (`difference = 0`). `tolerance` and `iterations` are part of the `BalancingConfig` struct."><title>balance in sp_npos_elections::balancing - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-ba5701c5741a7b69.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="sp_npos_elections" data-themes="" data-resource-suffix="" data-rustdoc-version="1.70.0 (90c541806 2023-05-31)" data-search-js="search-e077946657036a58.js" data-settings-js="settings-298e1ea74db45b39.js" data-settings-css="settings-7bfb4c59cc6bc502.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ></div><script src="../../static.files/storage-62ce34ea385b278a.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-f61008743c98d196.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../sp_npos_elections/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../sp_npos_elections/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><div class="sidebar-elems"><h2><a href="index.html">In sp_npos_elections::balancing</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Function <a href="../index.html">sp_npos_elections</a>::<wbr><a href="index.html">balancing</a>::<wbr><a class="fn" href="#">balance</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../src/sp_npos_elections/balancing.rs.html#58-81">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub fn balance&lt;AccountId: <a class="trait" href="../traits/trait.IdentifierT.html" title="trait sp_npos_elections::traits::IdentifierT">IdentifierT</a>&gt;(
    voters: &amp;mut <a class="struct" href="https://doc.rust-lang.org/1.70.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../struct.Voter.html" title="struct sp_npos_elections::Voter">Voter</a>&lt;AccountId&gt;&gt;,
    config: &amp;<a class="struct" href="../struct.BalancingConfig.html" title="struct sp_npos_elections::BalancingConfig">BalancingConfig</a>
) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.usize.html">usize</a></code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Balance the weight distribution of a given <code>voters</code> at most <code>iterations</code> times, or up until the
point where the biggest difference created per iteration of all stakes is <code>tolerance</code>. If this
is called with <code>tolerance = 0</code>, then exactly <code>iterations</code> rounds will be executed, except if no
change has been made (<code>difference = 0</code>). <code>tolerance</code> and <code>iterations</code> are part of the
<a href="../struct.BalancingConfig.html" title="struct sp_npos_elections::BalancingConfig"><code>BalancingConfig</code></a> struct.</p>
<p>In almost all cases, a balanced solution will have a better score than an unbalanced solution,
yet this is not 100% guaranteed because the first element of a <a href="../struct.ElectionScore.html" title="struct sp_npos_elections::ElectionScore"><code>crate::ElectionScore</code></a> does not
directly relate to balancing.</p>
<p>Note that some reference implementation adopt an approach in which voters are balanced randomly
per round. To advocate determinism, we don’t do this. In each round, all voters are exactly
balanced once, in the same order.</p>
<p>Also, note that due to re-distribution of weights, the outcome of this function might contain
edges with weight zero. The call site should filter such weight if desirable. Moreover, the
outcome might need balance re-normalization, see <code>Voter::try_normalize</code>.</p>
<h4 id="references"><a href="#references">References</a></h4>
<ul>
<li><a href="https://dl.acm.org/doi/10.1145/48014.61051">A new approach to the maximum flow problem</a>.</li>
<li><a href="https://arxiv.org/abs/2004.12990">Validator election in nominated proof-of-stake</a> (Appendix
A.)</li>
<li><a href="https://research.web3.foundation/en/latest/polkadot/NPoS/3.%20Balancing.html">Computing a balanced solution</a>,
which contains the details of the algorithm implementation.</li>
</ul>
</div></details></section></div></main></body></html>