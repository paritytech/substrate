<!DOCTYPE html><html lang="en"><head><link rel="canonical" href="https://paritytech.github.io/polkadot-sdk/master/substrate_test_runtime_client/sc_executor/sp_wasm_interface/wasmtime/trait.ResourceLimiter.html"><meta http-equiv="refresh" content="0;URL='https://paritytech.github.io/polkadot-sdk/master/substrate_test_runtime_client/sc_executor/sp_wasm_interface/wasmtime/trait.ResourceLimiter.html'"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Used by hosts to limit resource consumption of instances."><title>ResourceLimiter in substrate_test_runtime_client::sc_executor::sp_wasm_interface::wasmtime - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-ba5701c5741a7b69.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="substrate_test_runtime_client" data-themes="" data-resource-suffix="" data-rustdoc-version="1.70.0 (90c541806 2023-05-31)" data-search-js="search-e077946657036a58.js" data-settings-js="settings-298e1ea74db45b39.js" data-settings-css="settings-7bfb4c59cc6bc502.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ></div><script src="../../../../static.files/storage-62ce34ea385b278a.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../../static.files/main-f61008743c98d196.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../../../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../../../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../../../substrate_test_runtime_client/index.html"><img class="rust-logo" src="../../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../../../substrate_test_runtime_client/index.html"><img class="rust-logo" src="../../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">ResourceLimiter</a></h2><div class="sidebar-elems"><section><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.memory_growing">memory_growing</a></li><li><a href="#tymethod.table_growing">table_growing</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.instances">instances</a></li><li><a href="#method.memories">memories</a></li><li><a href="#method.memory_grow_failed">memory_grow_failed</a></li><li><a href="#method.table_grow_failed">table_grow_failed</a></li><li><a href="#method.tables">tables</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In substrate_test_runtime_client::sc_executor::sp_wasm_interface::wasmtime</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="../../../index.html">substrate_test_runtime_client</a>::<wbr><a href="../../index.html">sc_executor</a>::<wbr><a href="../index.html">sp_wasm_interface</a>::<wbr><a href="index.html">wasmtime</a>::<wbr><a class="trait" href="#">ResourceLimiter</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait ResourceLimiter {
    // Required methods
    fn <a href="#tymethod.memory_growing" class="fn">memory_growing</a>(
        &amp;mut self,
        current: <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.usize.html">usize</a>,
        desired: <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.usize.html">usize</a>,
        maximum: <a class="enum" href="https://doc.rust-lang.org/1.70.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.usize.html">usize</a>&gt;
    ) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.bool.html">bool</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.table_growing" class="fn">table_growing</a>(
        &amp;mut self,
        current: <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.u32.html">u32</a>,
        desired: <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.u32.html">u32</a>,
        maximum: <a class="enum" href="https://doc.rust-lang.org/1.70.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.u32.html">u32</a>&gt;
    ) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.bool.html">bool</a>;

    // Provided methods
    fn <a href="#method.memory_grow_failed" class="fn">memory_grow_failed</a>(&amp;mut self, _error: &amp;<a class="struct" href="../anyhow/struct.Error.html" title="struct substrate_test_runtime_client::sc_executor::sp_wasm_interface::anyhow::Error">Error</a>) { ... }
<span class="item-spacer"></span>    fn <a href="#method.table_grow_failed" class="fn">table_grow_failed</a>(&amp;mut self, _error: &amp;<a class="struct" href="../anyhow/struct.Error.html" title="struct substrate_test_runtime_client::sc_executor::sp_wasm_interface::anyhow::Error">Error</a>) { ... }
<span class="item-spacer"></span>    fn <a href="#method.instances" class="fn">instances</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.usize.html">usize</a> { ... }
<span class="item-spacer"></span>    fn <a href="#method.tables" class="fn">tables</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.usize.html">usize</a> { ... }
<span class="item-spacer"></span>    fn <a href="#method.memories" class="fn">memories</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.usize.html">usize</a> { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Used by hosts to limit resource consumption of instances.</p>
<p>This trait is used in conjunction with the
<a href="struct.Store.html#method.limiter" title="method substrate_test_runtime_client::sc_executor::sp_wasm_interface::wasmtime::Store::limiter"><code>Store::limiter</code></a> to synchronously limit the
allocation of resources within a store. As a store-level limit this means
that all creation of instances, memories, and tables are limited within the
store. Resources limited via this trait are primarily related to memory and
limiting CPU resources needs to be done with something such as
<a href="struct.Config.html#method.consume_fuel" title="method substrate_test_runtime_client::sc_executor::sp_wasm_interface::wasmtime::Config::consume_fuel"><code>Config::consume_fuel</code></a> or
<a href="struct.Config.html#method.epoch_interruption" title="method substrate_test_runtime_client::sc_executor::sp_wasm_interface::wasmtime::Config::epoch_interruption"><code>Config::epoch_interruption</code></a>.</p>
<p>Note that this trait does not limit 100% of memory allocated via a
<a href="struct.Store.html" title="struct substrate_test_runtime_client::sc_executor::sp_wasm_interface::wasmtime::Store"><code>Store</code></a>. Wasmtime will still allocate memory to track data
structures and additionally embedder-specific memory allocations are not
tracked via this trait. This trait only limits resources allocated by a
WebAssembly instance itself.</p>
<p>This trait is intended for synchronously limiting the resources of a module.
If your use case requires blocking to answer whether a request is permitted
or not and you’re otherwise working in an asynchronous context the
[<code>ResourceLimiterAsync</code>] trait is also provided to avoid blocking an OS
thread while a limit is determined.</p>
</div></details><h2 id="required-methods" class="small-section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.memory_growing" class="method"><h4 class="code-header">fn <a href="#tymethod.memory_growing" class="fn">memory_growing</a>(
    &amp;mut self,
    current: <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.usize.html">usize</a>,
    desired: <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.usize.html">usize</a>,
    maximum: <a class="enum" href="https://doc.rust-lang.org/1.70.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.usize.html">usize</a>&gt;
) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.bool.html">bool</a></h4></section></summary><div class="docblock"><p>Notifies the resource limiter that an instance’s linear memory has been
requested to grow.</p>
<ul>
<li><code>current</code> is the current size of the linear memory in bytes.</li>
<li><code>desired</code> is the desired size of the linear memory in bytes.</li>
<li><code>maximum</code> is either the linear memory’s maximum or a maximum from an
instance allocator, also in bytes. A value of <code>None</code>
indicates that the linear memory is unbounded.</li>
</ul>
<p>The <code>current</code> and <code>desired</code> amounts are guaranteed to always be
multiples of the WebAssembly page size, 64KiB.</p>
<p>This function should return <code>true</code> to indicate that the growing
operation is permitted or <code>false</code> if not permitted. Returning <code>true</code>
when a maximum has been exceeded will have no effect as the linear
memory will not grow.</p>
<p>This function is not guaranteed to be invoked for all requests to
<code>memory.grow</code>. Requests where the allocation requested size doesn’t fit
in <code>usize</code> or exceeds the memory’s listed maximum size may not invoke
this method.</p>
<p>Returning <code>false</code> from this method will cause the <code>memory.grow</code>
instruction in a module to return -1 (failure), or in the case of an
embedder API calling <a href="struct.Memory.html#method.new" title="associated function substrate_test_runtime_client::sc_executor::sp_wasm_interface::wasmtime::Memory::new"><code>Memory::new</code></a> or
<a href="struct.Memory.html#method.grow" title="method substrate_test_runtime_client::sc_executor::sp_wasm_interface::wasmtime::Memory::grow"><code>Memory::grow</code></a> an error will be returned from
those methods.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.table_growing" class="method"><h4 class="code-header">fn <a href="#tymethod.table_growing" class="fn">table_growing</a>(
    &amp;mut self,
    current: <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.u32.html">u32</a>,
    desired: <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.u32.html">u32</a>,
    maximum: <a class="enum" href="https://doc.rust-lang.org/1.70.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.u32.html">u32</a>&gt;
) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.bool.html">bool</a></h4></section></summary><div class="docblock"><p>Notifies the resource limiter that an instance’s table has been
requested to grow.</p>
<ul>
<li><code>current</code> is the current number of elements in the table.</li>
<li><code>desired</code> is the desired number of elements in the table.</li>
<li><code>maximum</code> is either the table’s maximum or a maximum from an instance
allocator.  A value of <code>None</code> indicates that the table is unbounded.</li>
</ul>
<p>This function should return <code>true</code> to indicate that the growing
operation is permitted or <code>false</code> if not permitted. Returning <code>true</code>
when a maximum has been exceeded will have no effect as the table will
not grow.</p>
<p>Currently in Wasmtime each table element requires a pointer’s worth of
space (e.g. <code>mem::size_of::&lt;usize&gt;()</code>).</p>
<p>Like <code>memory_growing</code> returning <code>false</code> from this function will cause
<code>table.grow</code> to return -1 or embedder APIs will return an error.</p>
</div></details></div><h2 id="provided-methods" class="small-section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.memory_grow_failed" class="method"><h4 class="code-header">fn <a href="#method.memory_grow_failed" class="fn">memory_grow_failed</a>(&amp;mut self, _error: &amp;<a class="struct" href="../anyhow/struct.Error.html" title="struct substrate_test_runtime_client::sc_executor::sp_wasm_interface::anyhow::Error">Error</a>)</h4></section></summary><div class="docblock"><p>Notifies the resource limiter that growing a linear memory, permitted by
the <code>memory_growing</code> method, has failed.</p>
<p>Reasons for failure include: the growth exceeds the <code>maximum</code> passed to
<code>memory_growing</code>, or the operating system failed to allocate additional
memory. In that case, <code>error</code> might be downcastable to a <code>std::io::Error</code>.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.table_grow_failed" class="method"><h4 class="code-header">fn <a href="#method.table_grow_failed" class="fn">table_grow_failed</a>(&amp;mut self, _error: &amp;<a class="struct" href="../anyhow/struct.Error.html" title="struct substrate_test_runtime_client::sc_executor::sp_wasm_interface::anyhow::Error">Error</a>)</h4></section></summary><div class="docblock"><p>Notifies the resource limiter that growing a linear memory, permitted by
the <code>table_growing</code> method, has failed.</p>
<p>Reasons for failure include: the growth exceeds the <code>maximum</code> passed to
<code>table_growing</code>. This could expand in the future.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.instances" class="method"><h4 class="code-header">fn <a href="#method.instances" class="fn">instances</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.usize.html">usize</a></h4></section></summary><div class="docblock"><p>The maximum number of instances that can be created for a <code>Store</code>.</p>
<p>Module instantiation will fail if this limit is exceeded.</p>
<p>This value defaults to 10,000.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.tables" class="method"><h4 class="code-header">fn <a href="#method.tables" class="fn">tables</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.usize.html">usize</a></h4></section></summary><div class="docblock"><p>The maximum number of tables that can be created for a <code>Store</code>.</p>
<p>Creation of tables will fail if this limit is exceeded.</p>
<p>This value defaults to 10,000.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.memories" class="method"><h4 class="code-header">fn <a href="#method.memories" class="fn">memories</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.70.0/std/primitive.usize.html">usize</a></h4></section></summary><div class="docblock"><p>The maximum number of linear memories that can be created for a <code>Store</code></p>
<p>Creation of memories will fail with an error if this limit is exceeded.</p>
<p>This value defaults to 10,000.</p>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><section id="impl-ResourceLimiter-for-StoreLimits" class="impl"><a href="#impl-ResourceLimiter-for-StoreLimits" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.ResourceLimiter.html" title="trait substrate_test_runtime_client::sc_executor::sp_wasm_interface::wasmtime::ResourceLimiter">ResourceLimiter</a> for <a class="struct" href="struct.StoreLimits.html" title="struct substrate_test_runtime_client::sc_executor::sp_wasm_interface::wasmtime::StoreLimits">StoreLimits</a></h3></section></div><script src="../../../../implementors/wasmtime/limits/trait.ResourceLimiter.js" data-ignore-extern-crates="wasmtime" async></script></section></div></main></body></html>